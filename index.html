<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Bildersammlung</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: rgb(12, 12, 12);
      color: #fff;
      max-width: 800px;
      margin: 40px auto;
    }

    label {
      font-weight: bold;
    }

    input, select, button {
      padding: 8px;
      margin: 5px 0;
      width: 100%;
      box-sizing: border-box;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      border: 1px solid #444;
      padding: 8px;
      background: #1a1a1a;
    }

    button {
      background-color: #333;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background-color: #555;
    }

    .checkbox-group {
      margin: 10px 0;
    }

    .checkbox-group label {
      display: block;
      margin: 8px 0;
    }

    .slider-label {
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <h1>Bilder sammeln</h1>

  <!-- 1. Bild -->
  <label for="image">üì∑ Bild hochladen:</label>
  <input type="file" id="image" accept="image/*">

  <!-- 2. Zutatenliste -->
  <h3>üçΩ Zutatenliste</h3>
  <table id="ingredientsTable">
    <thead>
      <tr>
        <th>Zutat</th>
        <th>Menge</th>
        <th>Einheit</th>
        <th>L√∂schen</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button onclick="addIngredient()">Hinzuf√ºgen</button>

  <!-- 3. Kontrollfragen -->
  <h3>üìã Bildqualit√§t</h3>
  <div class="checkbox-group">
    <label><input type="checkbox" id="sharp"> Ist das Bild scharf und gut beleuchtet?</label>
    <label><input type="checkbox" id="angle"> Ist das Bild in einem schr√§gen Winkel von ca. 45¬∞ aufgenommen?</label>
    <label><input type="checkbox" id="full"> Ist das Essen vollst√§ndig im Bild zu sehen ( = kein Millimeter ist abgeschnitten)?</label>
    <label><input type="checkbox" id="noother"> Ist sonstiges Essen oder Trinken im Bild zu sehen?</label>
  </div>

  <!-- 4. Zubereitungsart -->
  <label for="prep">Zubereitungsart:</label>
  <select id="prep">
    <option>gekocht</option>
    <option>gebraten</option>
    <option>gebacken</option>
    <option>frittiert</option>
    <option>sonstiges</option>
  </select>

  <!-- 5. Portionen -->
  <label class="slider-label" for="portions">Portionsgr√∂√üe:</label>
  <input type="range" id="portions" min="1" max="8" value="1" oninput="portionOutput.value = portions.value">
  <output id="portionOutput">1</output>

  <!-- 6. Speichern -->
  <button onclick="exportJSON()">üíæ Speichern</button>

  <script>
    function addIngredient() {
      const table = document.getElementById("ingredientsTable").getElementsByTagName('tbody')[0];
      const row = table.insertRow();

      const cell1 = row.insertCell(0);
      const inputName = document.createElement("input");
      inputName.type = "text";
      cell1.appendChild(inputName);

      const cell2 = row.insertCell(1);
      const inputAmount = document.createElement("input");
      inputAmount.type = "number";
      inputAmount.min = "0";
      cell2.appendChild(inputAmount);

      const cell3 = row.insertCell(2);
      const selectUnit = document.createElement("select");
      ["g", "ml", "St√ºck", "TL", "EL", "Tasse", "Scheibe", "Prise"].forEach(unit => {
        const option = document.createElement("option");
        option.value = unit;
        option.text = unit;
        selectUnit.appendChild(option);
      });
      cell3.appendChild(selectUnit);

      const cell4 = row.insertCell(3);
      const delButton = document.createElement("button");
      delButton.textContent = "‚úñ";
      delButton.onclick = () => row.remove();
      cell4.appendChild(delButton);
    }

    function exportJSON() {
      const imageInput = document.getElementById("image");
      const imageName = imageInput.files.length > 0 ? imageInput.files[0].name : "kein_bild.jpg";

      const ingredients = [];
      const table = document.getElementById("ingredientsTable").getElementsByTagName('tbody')[0];
      const rows = table.getElementsByTagName('tr');
      for (let row of rows) {
        const name = row.cells[0].querySelector('input').value.trim();
        const amount = parseFloat(row.cells[1].querySelector('input').value);
        const unit = row.cells[2].querySelector('select').value;
        if (name && !isNaN(amount)) {
          ingredients.push({ name, amount, unit });
        }
      }

      const data = {
        image_id: imageName,
        view_angle: "45_degree",
        full_plate: document.getElementById("full").checked,
        no_foreign_objects: !document.getElementById("noother").checked,
        sharp: document.getElementById("sharp").checked,
        angle_correct: document.getElementById("angle").checked,
        prep_method: document.getElementById("prep").value,
        portions: parseInt(document.getElementById("portions").value),
        ingredients: ingredients
      };

      const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "rezept.json";
      a.click();
    }

    // Initiale Zutat hinzuf√ºgen
    window.onload = addIngredient;
  </script>
</body>
</html>
