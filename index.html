<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Bildersammlung</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: rgb(12, 12, 12);
      color: #fff;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
    }

    label, h3, .question-block {
      margin-top: 20px;
      display: block;
    }

    input, select {
      padding: 8px;
      margin-top: 5px;
      margin-bottom: 20px;
      width: 100%;
      box-sizing: border-box;
    }

    select {
      width: 100%;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      border: 1px solid #444;
      padding: 8px;
      background: #1a1a1a;
    }

    button {
      background-color: #333;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 15px;
      padding: 10px 18px;
      margin-top: 20px;
    }

    button:hover {
      background-color: #555;
    }

    .slider-label {
      margin-top: 20px;
      display: block;
    }

    .radio-group label {
      display: inline-block;
      margin-right: 20px;
    }

    .question-block {
      margin: 20px 0;
    }

    #saveButton {
      font-size: 16px;
      padding: 12px 24px;
    }
  </style>
</head>
<body>

  <h1>Bild mit Zutaten und Mengen</h1>

  <!-- 1. Bild -->
  <label for="image">üì∑ Bild hochladen:</label>
  <input type="file" id="image" accept="image/*">

  <!-- 2. Zutatenliste -->
  <h3>üçΩ Zutatenliste</h3>
  <table id="ingredientsTable">
    <thead>
      <tr>
        <th>Zutat</th>
        <th>Menge</th>
        <th>Einheit</th>
        <th>L√∂schen</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button onclick="addIngredient()">Hinzuf√ºgen</button>

  <!-- 3. Kontrollfragen -->
  <h3>üìã Bildqualit√§t</h3>

  <div class="question-block">
    Ist das Bild scharf und gut beleuchtet?<br>
    <div class="radio-group">
      <label><input type="radio" name="sharp" value="yes"> Ja</label>
      <label><input type="radio" name="sharp" value="no"> Nein</label>
    </div>
  </div>

  <div class="question-block">
    Ist das Bild in einem schr√§gen Winkel von ca. 45¬∞ aufgenommen?<br>
    <div class="radio-group">
      <label><input type="radio" name="angle" value="yes"> Ja</label>
      <label><input type="radio" name="angle" value="no"> Nein</label>
    </div>
  </div>

  <div class="question-block">
    Ist das Essen vollst√§ndig im Bild zu sehen ( = kein Millimeter ist abgeschnitten)?<br>
    <div class="radio-group">
      <label><input type="radio" name="full" value="yes"> Ja</label>
      <label><input type="radio" name="full" value="no"> Nein</label>
    </div>
  </div>

  <div class="question-block">
    Ist sonstiges Essen oder Trinken im Bild zu sehen?<br>
    <div class="radio-group">
      <label><input type="radio" name="noother" value="no"> Nein</label>
      <label><input type="radio" name="noother" value="yes"> Ja</label>
    </div>
  </div>

  <!-- 4. Zubereitungsart -->
  <label for="prep">Zubereitungsart:</label>
  <select id="prep">
    <option>gekocht</option>
    <option>gebraten</option>
    <option>gebacken</option>
    <option>frittiert</option>
    <option>sonstiges</option>
  </select>

  <!-- 5. Portionen -->
  <label class="slider-label" for="portions">Portionsgr√∂√üe:</label>
  <input type="range" id="portions" min="1" max="8" value="1" oninput="portionOutput.value = portions.value">
  <output id="portionOutput">1</output>

  <!-- 6. Speichern -->
  <button id="saveButton" onclick="exportJSON()">üíæ Speichern</button>

  <script>
    function addIngredient() {
      const table = document.getElementById("ingredientsTable").getElementsByTagName('tbody')[0];
      const row = table.insertRow();

      const cell1 = row.insertCell(0);
      const inputName = document.createElement("input");
      inputName.type = "text";
      cell1.appendChild(inputName);

      const cell2 = row.insertCell(1);
      const inputAmount = document.createElement("input");
      inputAmount.type = "number";
      inputAmount.min = "0";
      cell2.appendChild(inputAmount);

      const cell3 = row.insertCell(2);
      const selectUnit = document.createElement("select");
      ["g", "ml", "St√ºck", "TL", "EL", "Tasse", "Scheibe", "Prise"].forEach(unit => {
        const option = document.createElement("option");
        option.value = unit;
        option.text = unit;
        selectUnit.appendChild(option);
      });
      cell3.appendChild(selectUnit);

      const cell4 = row.insertCell(3);
      const delButton = document.createElement("button");
      delButton.textContent = "‚úñ";
      delButton.onclick = () => row.remove();
      cell4.appendChild(delButton);
    }

    function getRadioValue(name) {
      const radios = document.getElementsByName(name);
      for (let radio of radios) {
        if (radio.checked) return radio.value === "yes";
      }
      return null;
    }

    function exportJSON() {
      const imageInput = document.getElementById("image");
      const imageName = imageInput.files.length > 0 ? imageInput.files[0].name : "kein_bild.jpg";

      const ingredients = [];
      const table = document.getElementById("ingredientsTable").getElementsByTagName('tbody')[0];
      const rows = table.getElementsByTagName('tr');
      for (let row of rows) {
        const name = row.cells[0].querySelector('input').value.trim();
        const amount = parseFloat(row.cells[1].querySelector('input').value);
        const unit = row.cells[2].querySelector('select').value;
        if (name && !isNaN(amount)) {
          ingredients.push({ name, amount, unit });
        }
      }

      const data = {
        image_id: imageName,
        view_angle: "45_degree",
        full_plate: getRadioValue("full"),
        no_foreign_objects: !getRadioValue("noother"),
        sharp: getRadioValue("sharp"),
        angle_correct: getRadioValue("angle"),
        prep_method: document.getElementById("prep").value,
        portions: parseInt(document.getElementById("portions").value),
        ingredients: ingredients
      };

      const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "rezept.json";
      a.click();
    }

    window.onload = addIngredient;
  </script>
</body>
</html>
